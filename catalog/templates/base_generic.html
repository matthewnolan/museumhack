<!DOCTYPE html>
<html lang="en">
<head>
  
  {% block title %}<title>Museum Donor List</title>{% endblock %}
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  
  {% load static %}
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>

<body>

  <div class="container-fluid">

    <div class="row">
      <div class="col-sm-2">
      {% block sidebar %}
      <ul class="sidebar-nav">
          <li><a href="{% url 'index' %}">Home</a></li>
          <li><a href="{% url 'persons' %}">All Donors</a></li>
          <li><a href="{% url 'donorgroups' %}">All Donorgroups</a></li>
          <li><a href="{% url 'institutions' %}">All Institutions</a></li>
      </ul>
      {% if user.is_authenticated %}
      <ul class="sidebar-nav">
        <li>User: {{ user.get_username }}</li>
        <li><a href="{% url 'logout'%}?next={{request.path}}">Logout</a></li>   
      {% else %}
        <li><a href="{% url 'login'%}?next={{request.path}}">Login</a></li>   
      </ul>
      {% endif %} 

      {% if user.is_staff %}
      <ul class="sidebar-nav">
        <li>Staff Member</li>
      </ul>
      {% endif %} 

     {% endblock %}
      </div>
      <div class="col-sm-10 ">
      {% block content %}{% endblock %}
      </div>
    </div>

  </div>
</body>
<script>

$(document).ready(function(){

  $('#importJsonBtn').click(function(evt) {
      $("#file-input").click();
  });
  $("#file-input").change(function(e){
    importJson(e)
  })

  // first get the CSRF token
  function getCookie(name) {
      var cookieValue = null;
      if (document.cookie && document.cookie !== '') {
          var cookies = document.cookie.split(';');
          for (var i = 0; i < cookies.length; i++) {
              var cookie = jQuery.trim(cookies[i]);
              // Does this cookie string begin with the name we want?
              if (cookie.substring(0, name.length + 1) === (name + '=')) {
                  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                  break;
              }
          }
      }
      return cookieValue;
  }
  var csrftoken = getCookie('csrftoken');
  function csrfSafeMethod(method) {
      // these HTTP methods do not require CSRF protection
      return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
  }


  function importJson(e) {
      // console.log("importJson ", e);
      var file = e.target.files[0];
      if (!file) {
          return;
      }
      var reader = new FileReader();
      reader.onload = function(e) {
          var contents = e.target.result;

          $.ajaxSetup({
              beforeSend: function(xhr, settings) {
                  if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                      xhr.setRequestHeader("X-CSRFToken", csrftoken);
                  }
              }
          });

          $.ajax({
              url : '/catalog/uploadcsv/upload/',
              type : 'POST',
              data : contents,
              dataType:'text/csv',
              success : function(data) {              
                  console.log('Data: '+data);
              },
              error : function(request,error)
              {
                  console.log("Request: "+JSON.stringify(request));
              }
          });
      };
      reader.readAsText(file);
  }

});






</script>
</html>